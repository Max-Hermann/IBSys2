<div class="row wrapper border-bottom white-bg page-heading">
	<div class="col-lg-10">
		<h2>Datei</h2>
		<ol class="breadcrumb">
			<li>
				<a href="/#/">Home</a>
			</li>
			<li class="active">
				<strong>Datei</strong>
			</li>
		</ol>
	</div>
</div>
<div class="container">
	<div class="jumbotron">
		<div class="row">
			<form>
				<div class="form-group">
					<label for="dateiInput">Datei hier hochladen</label>
					<input type="file" id="dateiInput" onchange="verarbeiteDatei(this.files)">
				</div>
			</form>
		</div>
	</div>
	<div class="jumbotron">
		<div class="row">
			<div class="col-md-12"><h3>Fertig mit der Eingabe? Dann erstellen Sie hier eine Datei.</h3></div>
		</div>
		<div class="row">
			<div class="col-md-12"><button class="btn btn-success btn-lg btn-block" ng-click="fc.sendPostRequest()">Datei erstellen</button></div>
		</div>
		<div class="row">
			<div ng-if="fc.dateiService.dateiErzeugt" class="col-md-12">
				<a ng-href="/download?dateiName={{fc.dateiService.dateiName}}" target="_blank">
				<button class="btn btn-warning btn-lg btn-block">
				{{fc.result}} downloaden.
				</button></a>
			</div>
		</div>
	</div>
</div>
<script>
		var verarbeiteDatei= function(dateien) {
    		
			var datei = dateien[0];
			var type = datei.type;
			if (type !== 'text/plain') {
				alert('Ung√ºltiges Dateiformat.');
				return;
			}
			var x2js = new X2JS();
			var result;	
			
			var reader = new FileReader();
			
			reader.onload = function(e) {
				result = reader.result;
			
				var json = x2js.xml_str2json(result);
			
				var text = JSON.stringify(json);
				var obj = JSON.parse(text);
			
				var dateiInput = document.getElementById('dateiInput');
				angular.element(dateiInput).controller().change(obj);
			}
			reader.readAsText(datei);
		}		
</script>